<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Lisper - Discover and share anonymous secrets"
    />
    <!-- Dark Reader Compatibility -->
    <meta name="color-scheme" content="dark" />
    <meta name="theme-color" content="#0a0f1a" />
    <meta name="darkreader-lock" content="This site is already dark-themed" />
    <title>Lisper - What's Your Secret?</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Gloria+Hallelujah&family=Inter:wght@400;500;600&family=Titan+One&display=swap"
      rel="stylesheet"
    />

    <!-- Styles -->
    <link rel="stylesheet" type="text/css" href="styles/main.css" />
  </head>

  <body>
    <!-- Background Effects -->
    <div class="background-effects">
      <div class="gradient-overlay"></div>
      <div class="grid-pattern"></div>
    </div>

    <!-- Main Title -->
    <h1 class="main-title">What's your secret?</h1>

    <!-- Card Container -->
    <div class="card-container">
      <!-- Secret Card -->
      <div
        class="card"
        id="secret-card"
        role="article"
        aria-label="Secret message"
      >
        <p id="secret-text"><%= secret %></p>
      </div>

      <!-- User Attribution -->
      <p class="user" id="user-attribution"><%= user %></p>
    </div>

    <!-- New Secret Button -->
    <button
      class="new-secret-btn"
      id="new-secret-btn"
      type="button"
      aria-label="Get a new secret"
    >
      <span class="btn-text">Reveal New Secret</span>
    </button>

    <!-- Footer -->
    <footer class="footer">
      <p>
        Powered by
        <a
          href="https://secrets-api.appbrewery.com"
          target="_blank"
          rel="noopener noreferrer"
          >Secrets API</a
        >
      </p>
    </footer>

    <!-- Client-side JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', () => {
        const newSecretBtn = document.getElementById('new-secret-btn');
        const secretText = document.getElementById('secret-text');
        const userAttribution = document.getElementById('user-attribution');
        const secretCard = document.getElementById('secret-card');

        // Fetch new secret from API
        async function fetchNewSecret() {
          try {
            // Add loading state
            newSecretBtn.classList.add('loading');
            newSecretBtn.disabled = true;

            // Fetch from our API endpoint
            const response = await fetch('/api/secret');

            if (!response.ok) {
              throw new Error('Failed to fetch secret');
            }

            const data = await response.json();

            // Animate the card
            secretCard.style.opacity = '0';
            secretCard.style.transform = 'scale(0.95)';

            // Update content after brief delay
            setTimeout(() => {
              secretText.textContent = data.secret;
              userAttribution.textContent = data.username;

              // Remove inline color style so CSS hover works
              secretCard.style.removeProperty('color');

              // Fade back in
              secretCard.style.opacity = '1';
              secretCard.style.transform = 'scale(1)';
            }, 300);
          } catch (error) {
            console.error('Error fetching secret:', error);
            secretText.textContent = 'Failed to load secret. Please try again.';
            userAttribution.textContent = 'Unknown';
          } finally {
            // Remove loading state
            setTimeout(() => {
              newSecretBtn.classList.remove('loading');
              newSecretBtn.disabled = false;
            }, 500);
          }
        }

        // Add click event listener
        newSecretBtn.addEventListener('click', fetchNewSecret);

        // Add smooth transitions for card
        secretCard.style.transition =
          'opacity 0.3s ease, transform 0.3s ease, color 1s ease';
      });
    </script>
  </body>
</html>
